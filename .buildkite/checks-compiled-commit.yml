env:
  LC_ALL: "en_US.UTF-8"
  NIX_PATH: "channel:nixos-21.11"

  # Per-host variables - shared across containers on host
  CACHE_DIR: "/cache/cardano-wallet"

steps:
  - label: 'Check auto-generated Nix'
    key: nix
    commands:
      - './nix/regenerate.sh'
    agents:
      system: x86_64-linux

  - label: 'Build all tests'
    depends_on: nix
    command: 'nix build .#ci.x86_64-linux.tests.build'
    agents:
      system: x86_64-linux

  - label: 'Run unit tests on linux'
    depends_on: nix
    command: 'nix build -L .#ci.x86_64-linux.tests.run.unit'
    agents:
      system: x86_64-linux
